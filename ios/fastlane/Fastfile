default_platform(:ios)

platform :ios do
  lane :simulator_build_check do
    # Clean and get dependencies
    sh("flutter pub get")

    # Build Flutter iOS for simulator
    sh("flutter build ios --simulator")

    # Xcode build using Fastlane gym (optional, since `flutter build ios` already does it)
    gym(
      workspace: "Runner.xcworkspace",
      scheme: "Runner",
      destination: "generic/platform=iOS Simulator",
      clean: true,
      skip_package_ipa: true,
      configuration: "Debug",
      export_method: "development",
      output_directory: "./build/simulator_build"
    )
  end
end
